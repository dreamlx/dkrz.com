<html class="ios iphone mobile portrait" xml:lang="zh-CN" lang="zh-CN">

<head>
    <title>平安直通-新一贷贷款</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="keywords" content="">
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="no">
    <meta name="format-detection" content="telephone=no">
    <meta name="email=no" content="format-detection">
    <link rel="stylesheet" type="text/css" href="./css/uA3eI4.css">
    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?f7443d64b18bc84243d3bc8316f7b171";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>

<body style="background-color: #F3F3F3;">
    <div class="body-wrapper page">
        <div class="body-inner-wrapper">
            <section class="event" id="sectionNode_0F9A2C46-54DA-42B4-AEC7-859BEB264BA6" style="margin-top:10px;margin-bottom: 10px;">
                <header class="question-wrapper">
                    <div class="top-tips">平安新一贷申请</div>
                </header>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">姓名：</div>
                    <div class="item-input">
                        <input type="text" id="name" />
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">手机：</div>
                    <div class="item-input">
                        <input type="tel" id="phone" />
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">性别:</div>
                    <div class="item-input">
                        <input type="text" id="sex" />
                        <i class="arrow"></i>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">出生日期:</div>
                    <div class="item-input">
                        <input type="text" id="birth" />
                        <i class="arrow"></i>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">工作城市:</div>
                    <div class="item-input">
                        <input type="text" id="workplace" />
                        <i class="arrow"></i>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">目前税前收入:</div>
                    <div class="item-input">
                        <input type="text" id="income" />
                        <i class="arrow"></i>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">发薪方式:</div>
                    <div class="item-input">
                        <input type="text" id="payoffType" />
                        <i class="arrow"></i>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">您的职业:</div>
                    <div class="item-input">
                        <input type="text" id="job" />
                        <i class="arrow"></i>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label ">目前有无信用卡:<span>无</span></div>
                    <div class="item-input switch">
                        <label class="label-switch">
                            <input type="checkbox" id="hasCreditCard">
                            <div class="checkbox"></div>
                        </label>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">目前有无贷款:<span>无</span></div>
                    <div class="item-input switch">
                        <label class="label-switch">
                            <input type="checkbox" id="loanExperience">
                            <div class="checkbox"></div>
                        </label>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">目前有无房贷:<span>无</span></div>
                    <div class="item-input switch">
                        <label class="label-switch">
                            <input type="checkbox" id="mortgage">
                            <div class="checkbox"></div>
                        </label>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">目前有无车贷:<span>无</span></div>
                    <div class="item-input switch">
                        <label class="label-switch">
                            <input type="checkbox" id="hasCarLoan">
                            <div class="checkbox"></div>
                        </label>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">有无正在缴费的人寿险:<span>无</span></div>
                    <div class="item-input switch">
                        <label class="label-switch">
                            <input type="checkbox" id="hasLifeInsurance">
                            <div class="checkbox"></div>
                        </label>
                    </div>
                </div>
            </section>
            <section class="item">
                <div class="item-inner">
                    <div class="item-label">是否正在缴纳公积金:<span>无</span></div>
                    <div class="item-input switch">
                        <label class="label-switch">
                            <input type="checkbox" id="hasAccumulationFund">
                            <div class="checkbox"></div>
                        </label>
                    </div>
                </div>
            </section>
            <div class="button-wrapper single min" id="stick">
                <div class="reward-tips message-container" style="display: none; opacity: 1;">
                    <p id="rewardLimit"></p>
                </div>
                <a class="button return" id="preQuestion" style="display: none; opacity: 1;"><span>上一题</span></a>
                <a class="button enter" id="nextQuestion" style="opacity: 1;"><span>提交</span></a>
            </div>
        </div>
        <footer>
            <div class="footer-container">
                <div class="progress-wrapper">
                    <div id="progress" style="width:1%"></div>
                </div>
                <a class="copyright" id="copyright"></a>
            </div>
        </footer>
    </div>
    <div id="message">
        <div class="message-container" id="errorText">申请已提交！</div>
    </div>
    <script type="text/javascript" src="./js/zepto/zepto.min.js"></script>
    <script type="text/javascript" src="./js/sm.js"></script>
    <script type='text/javascript' src='./js/city.picker.js' charset='utf-8'></script>
    <script type="text/javascript">
    var code = $.getQueryString('code'),
        openid = $.cookie.getCookie('nopenid'),
        serialNumber;

    if (!openid && !code) {
        window.location.href = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx25ed6dbf6f6ff8ac&redirect_uri=' + window.location.href + '&response_type=code&scope=snsapi_base&state=1#wechat_redirect'
    }

    if (!openid && code) {
        $.showIndicator();
        $.ajax({
            type: "GET",
            url: "lane/wechatoauth.php?code=" + code,
            success: function(result) {
                var res = eval("(" + result + ")");

                if (res.openid) {
                    openid = res.openid;
                    $.cookie.setCookie("nopenid", res.openid);
                    getSerialNumber();
                }
            },
            error: function() {
                $.hideIndicator();

            }
        })
    } else {

        getSerialNumber();
    }

    function getSerialNumber() {
        $.showIndicator();
        $.ajax({
            type: "GET",
            url: "/api/get_serial_number",
            success: function(result) {
                $.hideIndicator();
                serialNumber = result.serial_number;
            },
            error: function() {
                $.hideIndicator();

            }
        })

    }

    $("#birth").datetimePicker({
        values: [1980, 01, 01],
        toolbarTemplate: '<header class="bar bar-nav">\
                <button class="button button-link pull-right close-picker">确定</button>\
                <h1 class="title">您的出生日期</h1>\
                </header>'
    });

    $("#workplace").cityPicker({
        toolbarTemplate: '<header class="bar bar-nav">\
                <button class="button button-link pull-right close-picker">确定</button>\
                <h1 class="title">您的工作城市</h1>\
                </header>'
    });

    $("#job").picker({
        toolbarTemplate: '<header class="bar bar-nav">\
          <button class="button button-link pull-right close-picker">确定</button>\
          <h1 class="title">您目前的职业</h1>\
          </header>',
        cols: [{
            textAlign: 'center',
            values: ['公司职员', '私营业主', '公务员']
        }]
    });

    $("#sex").picker({
        toolbarTemplate: '<header class="bar bar-nav">\
          <button class="button button-link pull-right close-picker">确定</button>\
          <h1 class="title">性别</h1>\
          </header>',
        cols: [{
            textAlign: 'center',
            values: ['男', '女']
        }]
    });

    $("#payoffType").picker({
        toolbarTemplate: '<header class="bar bar-nav">\
          <button class="button button-link pull-right close-picker">确定</button>\
          <h1 class="title">您的发薪方式</h1>\
          </header>',
        cols: [{
            textAlign: 'center',
            values: ['银行转账发薪', '通过现金发薪']
        }]
    });

    $("#income").picker({
        toolbarTemplate: '<header class="bar bar-nav">\
          <button class="button button-link pull-right close-picker">确定</button>\
          <h1 class="title">您的目前税前收入</h1>\
          </header>',
        cols: [{
            textAlign: 'center',
            values: ['8000元以上', '7000元至7999元', '6000元至6999元', '5000元至5999元', '4000元至4999元', '3000元至3999元', '3000元以下']
        }]
    });



    $(function() {


        var channels = ['高铁WIFI', '无线WIFI', '厦门购房内参粉丝', '光阳中德', '金山WPS', '迅雷'],
            channelId = $.getQueryString("sub") || '001',
            channelIndex = parseInt(channelId);

        if (!isNaN(channelIndex) && channelIndex > 0 && channelIndex < 7) {
            $("#copyright").html(channels[channelIndex - 1] + '用户专属通道');
        }


        $(".label-switch .checkbox").on("click", function() {
            var $this = $(this),
                tfEnd = $(this).data("tfEnd");
            clearTimeout(tfEnd);
            tfEnd = setTimeout(function() {
                if ($this.parent().find("input")[0].checked) {
                    $this.parents(".item-inner").find(".item-label  span").addClass("active").html("有");
                } else {
                    $this.parents(".item-inner").find(".item-label  span").removeClass("active").html("无");
                }
            }, 301)
            $(this).data("tfEnd", tfEnd)
        })

        // $(".label-switch .checkbox").on("transitionend", function() {
        //     var $this = $(this),
        //         tfEnd = $(this).data("tfEnd");
        //     clearTimeout(tfEnd);
        //     tfEnd = setTimeout(function() {
        //         if ($this.parent().find("input")[0].checked) {
        //             $this.parents(".item-inner").find(".item-label  span").addClass("active").html("有");
        //         } else {
        //             $this.parents(".item-inner").find(".item-label  span").removeClass("active").html("无");
        //         }
        //     })
        //     $(this).data("tfEnd", tfEnd)
        // })

        // $(".label-switch .checkbox").on("webkitTransitionEnd", function() {
        //     var $this = $(this),
        //         tfEnd = $(this).data("tfEnd");
        //     clearTimeout(tfEnd);
        //     tfEnd = setTimeout(function() {
        //         if ($this.parent().find("input")[0].checked) {
        //             $this.parents(".item-inner").find(".item-label  span").addClass("active").html("有");
        //         } else {
        //             $this.parents(".item-inner").find(".item-label  span").removeClass("active").html("无");
        //         }
        //     })
        //     $(this).data("tfEnd", tfEnd)
        // })


        var displayTimer;

        function showErrorMsg(msg) {
            $("#message").css("visibility", "visible");
            $("#errorText").html(msg);
            clearTimeout(displayTimer);
            displayTimer = setTimeout(function() {
                $("#message").css("visibility", "hidden");
            }, 2000)
        }

        $(document).on("click", "#nextQuestion", function(e) {


            var name = $.trim($("#name").val());
            if (!name) {
                showErrorMsg("请填写姓名！");
                return;
            }
            var phone = $.trim($("#phone").val());
            if (!phone) {
                showErrorMsg("请填写手机号！");
                return;
            }
            var sex;
            if (sex = $("#sex").val(), !sex) {
                showErrorMsg("请选择您的性别！");
                return;
            }

            if (!/^1\d{10}$/.test(phone)) {
                showErrorMsg("手机号格式不正确!");
                return;
            }
            var birth = $.trim($("#birth").val());
            if (!birth) {
                showErrorMsg("请填写出生日期！");
                return;
            }

            var workplace = $.trim($("#workplace").val());
            if (!workplace) {
                showErrorMsg("请填写工作地！");
                return;
            }

            var income = $.trim($("#income").val());
            if (!income) {
                showErrorMsg("请填写您目前的税前收入");
                return;
            }
            var payoffType;
            if (payoffType = $("#payoffType").val(), !payoffType) {
                showErrorMsg("请选择您的发薪方式！");
                return;
            }
            var job = $("#job").val();
            if (!job) {
                showErrorMsg("请选择目前的职业！");
                return;
            }






            var hasCreditCard = $("#hasCreditCard")[0].checked;
            var loanExperience = $("#loanExperience")[0].checked;
            var mortgage = $("#mortgage")[0].checked;
            var hasCarLoan = $("#hasCarLoan")[0].checked;
            var hasLifeInsurance = $("#hasLifeInsurance").checked;
            var hasAccumulationFund = $("#hasAccumulationFund").checked;

            var now = new Date();
            var params = {
                channelId: channelId + "-" + serialNumber,
                channel: channelId + "-" + serialNumber,
                name: name,
                phone: phone,
                sex: sex == "男" ? 1 : 2,
                workplace: workplace.replace(/\s/ig, ''),
                birth: birth.replace(/-/ig, "/"),
                income: income.split("元")[0],
                hasCreditCard: hasCreditCard ? "Y" : "N",
                hasCarLoan: hasCarLoan ? "Y" : "N",
                hasAccumulationFund: hasAccumulationFund ? "Y" : "N",
                hasLifeInsurance: hasLifeInsurance ? "Y" : "N",
                mortgage: mortgage ? "Y" : "N",
                loanExperience: loanExperience ? "是" : "否",
                profession: job == "公司职员" ? 0 : job == "私营业主" ? 2 : 4,
                payoffType: payoffType == "银行转账发薪" ? 0 : 1
            };
            $.showIndicator();
            $.ajax({
                type: "POST",
                url: "/result.jsp",
                data: params,
                success: function(result) {


                    var xmldoc = result && result.documentElement;
                    if (xmldoc) {
                        if (xmldoc.getElementsByTagName("resultCode")[0].firstChild.textContent != "0") {
                            if (xmldoc.getElementsByTagName("errorCode")[0].firstChild.textContent == "035") {
                                showErrorMsg("性别有误!");
                                return;
                            }
                            showErrorMsg(xmldoc.getElementsByTagName("errorMsg")[0].firstChild.textContent);
                            return;
                        }
                    }


                    if (openid) {
                        $.ajax({
                            type: "POST",
                            url: "/api/leaders",
                            beforeSend: function(request) {
                                request.setRequestHeader("Authorization", "Token token=" + openid);
                            },
                            data: params,
                            success: function(result) {
                                $.hideIndicator();
                                window.location.href = "result.html?sub=" + channelId;
                            },
                            error: function() {
                                $.hideIndicator();
                                window.location.href = "result.html?sub=" + channelId;
                            }
                        })
                    } else {
                        window.location.href = "result.html?sub=" + channelId;
                    }

                },
                error: function() {
                    $.hideIndicator();
                }
            })

        });

    })
    </script>

    <body>

</html>
